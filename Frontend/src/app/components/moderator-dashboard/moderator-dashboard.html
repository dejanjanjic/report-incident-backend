<!-- Header -->
<mat-toolbar color="primary" class="main-header">
  <span class="header-title">
    <mat-icon>report_problem</mat-icon>
    Prijava incidenata
  </span>
  <span class="spacer"></span>
  <button mat-raised-button color="accent" class="logout-button" (click)="logout()">
    <mat-icon>logout</mat-icon>
    Odjava
  </button>
</mat-toolbar>

<!-- Main Content -->
<div class="main-container">

  <!-- Filters Section -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>filter_alt</mat-icon>
        Filteri za incidente
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <div class="filters-grid">
        
        <!-- Type Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Vrsta incidenta</mat-label>
          <mat-select [(value)]="selectedType" (selectionChange)="onTypeChange()">
            <mat-option value="">Sve vrste</mat-option>
            @for (type of incidentTypes; track type.value) {
              <mat-option [value]="type.value">
                {{type.label}}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <!-- Subtype Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Podvrsta incidenta</mat-label>
          <mat-select [(value)]="selectedSubtype" (selectionChange)="onSubtypeChange()" [disabled]="!selectedType">
            <mat-option value="">Sve podvrste</mat-option>
            @for (subtype of filteredSubtypes; track subtype.value) {
              <mat-option [value]="subtype.value">
                {{subtype.label}}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <!-- Time Range Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Vremenski period</mat-label>
          <mat-select [(value)]="selectedTimeRange" (selectionChange)="onTimeRangeChange()">
            @for (range of timeRanges; track range.value) {
              <mat-option [value]="range.value">
                {{range.label}}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <!-- Location Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Lokacija</mat-label>
          <input matInput [(ngModel)]="selectedLocation" (input)="onLocationChange()" placeholder="Unesite lokaciju...">
        </mat-form-field>
      </div>

      <!-- Filter Actions -->
      <div class="filter-actions">
        <button mat-stroked-button (click)="clearFilters()" class="clear-button">
          <mat-icon>clear_all</mat-icon>
          Obri≈°i filtere
        </button>
        @if (selectedType || selectedSubtype || selectedLocation) {
          <div class="active-filters">
            <span class="filters-label">Aktivni filteri:</span>
            <div class="chips-container">
              @if (selectedType) {
                <span class="filter-chip">
                  {{getTypeLabel(selectedType)}}
                  <mat-icon (click)="selectedType = ''; onTypeChange()">close</mat-icon>
                </span>
              }
              @if (!selectedType && selectedSubtype) {
                <span class="filter-chip">
                  {{getSubtypeLabel(selectedSubtype)}}
                  <mat-icon (click)="selectedSubtype = ''; onSubtypeChange()">close</mat-icon>
                </span>
              }
              @if (!selectedType && !selectedSubtype && selectedLocation) {
                <span class="filter-chip">
                  {{selectedLocation}}
                  <mat-icon (click)="selectedLocation = ''; onLocationChange()">close</mat-icon>
                </span>
              }
            </div>
          </div>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Map Section -->
  <mat-card class="map-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>map</mat-icon>
        Mapa incidenata
        <span class="map-instruction">Kliknite na mapu da izaberete lokaciju za prijavu</span>
      </mat-card-title>
    </mat-card-header>
    
    <mat-card-content class="map-content">
      <app-moderator-incident-map #incidentMap (locationSelected)="onMapLocationSelected($event)" [reportingEnabled]="true"></app-moderator-incident-map>
    </mat-card-content>
  </mat-card>
</div>
